{% extends "dashboard/layout.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid px-4">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ENCABEZADO                                 -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
            <h2 class="fw-bold mb-0">Panel de Control</h2>
            <p class="text-muted mb-0 small">
                Bienvenido, <strong>{{ request.user.nombre|default:request.user.email }}</strong>
            </p>
        </div>
        <span class="badge rounded-pill px-3 py-2 text-white"
              style="background: #4e73df; font-size:.85rem;">
            {% if cargo == 'administrador' %}ğŸ‘‘ Administrador
            {% elif cargo == 'cajera' %}ğŸ’° Cajera
            {% elif cargo == 'cocinero' %}ğŸ³ Cocinero
            {% elif cargo == 'parrilla' %}ğŸ”¥ Parrilla
            {% elif cargo == 'mesero' %}ğŸ½ï¸ Mesero
            {% endif %}
        </span>
    </div>


    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {# DASHBOARD ADMINISTRADOR                         #}
    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {% if cargo == 'administrador' %}

    <!-- Tarjetas resumen -->
    <div class="row g-3 mb-4">

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #4e73df !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Ventas Hoy</p>
                            <h4 class="fw-bold mb-0">${{ ventas_hoy_total|floatformat:2 }}</h4>
                            <small class="text-muted">{{ ventas_hoy_cantidad }} transacciones</small>
                        </div>
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                             style="width:50px;height:50px;background:#4e73df22;">
                            <i class='bx bx-dollar' style="font-size:1.6rem;color:#4e73df"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #1cc88a !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Ventas del Mes</p>
                            <h4 class="fw-bold mb-0">${{ ventas_mes_total|floatformat:2 }}</h4>
                            <small class="text-muted">{{ ventas_mes_cantidad }} transacciones</small>
                        </div>
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                             style="width:50px;height:50px;background:#1cc88a22;">
                            <i class='bx bx-trending-up' style="font-size:1.6rem;color:#1cc88a"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #f6c23e !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Pedidos Activos</p>
                            <h4 class="fw-bold mb-0">{{ pedidos_activos }}</h4>
                            <small class="text-muted">En proceso ahora</small>
                        </div>
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                             style="width:50px;height:50px;background:#f6c23e22;">
                            <i class='bx bx-receipt' style="font-size:1.6rem;color:#f6c23e"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #36b9cc !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Mesas</p>
                            <h4 class="fw-bold mb-0">{{ mesas_ocupadas }} / {{ total_mesas }}</h4>
                            <small class="text-muted">{{ mesas_libres }} disponibles</small>
                        </div>
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                             style="width:50px;height:50px;background:#36b9cc22;">
                            <i class='bx bxs-pin' style="font-size:1.6rem;color:#36b9cc"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- GrÃ¡ficos fila 1 -->
    <div class="row g-3 mb-4">

        <!-- Ingresos Ãºltimos 7 dÃ­as -->
        <div class="col-xl-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0"><i class='bx bx-line-chart me-2'></i>Ingresos Ãºltimos 7 dÃ­as</h6>
                </div>
                <div class="card-body">
                    <canvas id="chartIngresos" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Pedidos por estado -->
        <div class="col-xl-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bx-pie-chart me-2'></i>Pedidos por estado</h6>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center">
                    <canvas id="chartEstados" height="200"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- GrÃ¡ficos fila 2 + tablas -->
    <div class="row g-3 mb-4">

        <!-- Ventas por mÃ©todo de pago -->
        <div class="col-xl-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bx-credit-card me-2'></i>MÃ©todos de pago</h6>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center">
                    <canvas id="chartMetodos" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Ãšltimos pedidos -->
        <div class="col-xl-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0"><i class='bx bx-list-ul me-2'></i>Ãšltimos pedidos</h6>
                    <a href="{% url 'apl:menu:pedido_list' %}" class="btn btn-sm btn-outline-primary">Ver todos</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Pedido</th>
                                    <th>Cliente</th>
                                    <th>Mesa</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pedido in ultimos_pedidos %}
                                <tr>
                                    <td class="ps-3"><small class="fw-bold">#{{ pedido.numero_pedido }}</small></td>
                                    <td><small>{{ pedido.cliente_nombre }}</small></td>
                                    <td><small>{{ pedido.mesa|default:"â€”" }}</small></td>
                                    <td><small>${{ pedido.total|floatformat:2 }}</small></td>
                                    <td>
                                        {% if pedido.estado == 'pendiente' %}
                                            <span class="badge bg-warning text-dark">Pendiente</span>
                                        {% elif pedido.estado == 'preparando' %}
                                            <span class="badge bg-info">Preparando</span>
                                        {% elif pedido.estado == 'listo' %}
                                            <span class="badge bg-success">Listo</span>
                                        {% elif pedido.estado == 'entregado' %}
                                            <span class="badge bg-primary">Entregado</span>
                                        {% elif pedido.estado == 'cancelado' %}
                                            <span class="badge bg-danger">Cancelado</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-3">No hay pedidos recientes</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Productos bajo stock -->
    {% if productos_bajo_stock %}
    <div class="row g-3 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm border-start border-danger border-4">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0 text-danger">
                        <i class='bx bx-error-circle me-2'></i>Productos con bajo stock
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Producto</th>
                                    <th>Stock actual</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos_bajo_stock %}
                                <tr>
                                    <td class="ps-3"><small class="fw-bold">{{ producto.nombre }}</small></td>
                                    <td>
                                        <small>{{ producto.stock }}</small>
                                    </td>
                                    <td>
                                        {% if producto.stock == 0 %}
                                            <span class="badge bg-danger">Sin stock</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">Stock bajo</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% endif %}
    {# â”€â”€ fin administrador â”€â”€ #}


    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {# DASHBOARD CAJERA                                #}
    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {% if cargo == 'cajera' %}

    <div class="row g-3 mb-4">

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #4e73df !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Ventas Hoy</p>
                            <h4 class="fw-bold mb-0">${{ ventas_hoy_total|floatformat:2 }}</h4>
                            <small class="text-muted">{{ ventas_hoy_cantidad }} cobros</small>
                        </div>
                        <i class='bx bx-dollar-circle' style="font-size:2.5rem;color:#4e73df44"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #1cc88a !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Ventas del Mes</p>
                            <h4 class="fw-bold mb-0">${{ ventas_mes_total|floatformat:2 }}</h4>
                            <small class="text-muted">{{ ventas_mes_cantidad }} cobros</small>
                        </div>
                        <i class='bx bx-trending-up' style="font-size:2.5rem;color:#1cc88a44"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #f6c23e !important;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Pendientes de cobro</p>
                            <h4 class="fw-bold mb-0">{{ ventas_pendientes }}</h4>
                            <small class="text-muted">Sin procesar</small>
                        </div>
                        <i class='bx bx-time' style="font-size:2.5rem;color:#f6c23e44"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #36b9cc !important;">
                <div class="card-body d-flex align-items-center justify-content-center">
                    <a href="{% url 'apl:venta:venta_list' %}" class="btn btn-primary w-100 py-3">
                        <i class='bx bx-cash-register d-block' style="font-size:2rem;"></i>
                        Ir a Cobros
                    </a>
                </div>
            </div>
        </div>

    </div>

    <div class="row g-3 mb-4">
        <div class="col-xl-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bx-line-chart me-2'></i>Ingresos Ãºltimos 7 dÃ­as</h6>
                </div>
                <div class="card-body">
                    <canvas id="chartIngresos" height="120"></canvas>
                </div>
            </div>
        </div>

        <div class="col-xl-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bx-pie-chart me-2'></i>MÃ©todos de pago</h6>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center">
                    <canvas id="chartMetodos" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0"><i class='bx bx-list-ul me-2'></i>Ãšltimas ventas</h6>
                    <a href="{% url 'apl:venta:venta_list' %}" class="btn btn-sm btn-outline-primary">Ver todas</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Factura</th>
                                    <th>Cliente</th>
                                    <th>Total</th>
                                    <th>MÃ©todo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for venta in ultimas_ventas %}
                                <tr>
                                    <td class="ps-3"><small class="fw-bold">{{ venta.numero_factura }}</small></td>
                                    <td><small>{{ venta.cliente_nombre }}</small></td>
                                    <td><small>${{ venta.total|floatformat:2 }}</small></td>
                                    <td><small>{{ venta.get_metodo_pago_display|default:"â€”" }}</small></td>
                                    <td>
                                        {% if venta.estado == 'pagado' %}
                                            <span class="badge bg-success">Pagado</span>
                                        {% elif venta.estado == 'pendiente' %}
                                            <span class="badge bg-warning text-dark">Pendiente</span>
                                        {% else %}
                                            <span class="badge bg-danger">Anulada</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-3">No hay ventas recientes</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% endif %}
    {# â”€â”€ fin cajera â”€â”€ #}


    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {# DASHBOARD COCINERO / PARRILLA                   #}
    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {% if cargo == 'cocinero' or cargo == 'parrilla' %}

    <div class="row g-3 mb-4">

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #f6c23e !important;">
                <div class="card-body text-center py-4">
                    <i class='bx bx-time-five' style="font-size:3rem;color:#f6c23e"></i>
                    <h3 class="fw-bold mt-2 mb-0">{{ total_pendientes }}</h3>
                    <p class="text-muted mb-0">Pedidos pendientes</p>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #36b9cc !important;">
                <div class="card-body text-center py-4">
                    <i class='bx bx-loader-alt' style="font-size:3rem;color:#36b9cc"></i>
                    <h3 class="fw-bold mt-2 mb-0">{{ total_preparando }}</h3>
                    <p class="text-muted mb-0">En preparaciÃ³n</p>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #1cc88a !important;">
                <div class="card-body text-center py-4">
                    <i class='bx bx-check-circle' style="font-size:3rem;color:#1cc88a"></i>
                    <h3 class="fw-bold mt-2 mb-0">{{ total_listos }}</h3>
                    <p class="text-muted mb-0">Listos para entregar</p>
                </div>
            </div>
        </div>

    </div>

    <div class="row g-3 mb-4">

        <div class="col-xl-5">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bx-pie-chart me-2'></i>Estado de pedidos</h6>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center">
                    <canvas id="chartEstados" height="220"></canvas>
                </div>
            </div>
        </div>

        <div class="col-xl-7">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0">
                        <i class='bx bx-list-ul me-2'></i>
                        Pedidos pendientes
                    </h6>
                    <a href="{% url 'apl:menu:pedido_list' %}" class="btn btn-sm btn-outline-primary">Ver todos</a>
                </div>
                <div class="card-body p-0" style="max-height:350px; overflow-y:auto;">
                    {% for pedido in pedidos_pendientes %}
                    <div class="d-flex align-items-center justify-content-between px-3 py-2 border-bottom">
                        <div>
                            <span class="fw-bold small">#{{ pedido.numero_pedido }}</span>
                            <span class="text-muted small ms-2">{{ pedido.cliente_nombre }}</span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <small class="text-muted">{{ pedido.fecha_creacion|timesince }} ago</small>
                            <a href="{% url 'apl:menu:pedido_detail' pedido.pk %}"
                               class="btn btn-sm btn-warning py-0 px-2">Ver</a>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-center text-muted py-4">No hay pedidos pendientes</p>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>

    {% endif %}
    {# â”€â”€ fin cocinero/parrilla â”€â”€ #}


    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {# DASHBOARD MESERO                                #}
    {# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
    {% if cargo == 'mesero' %}

    <div class="row g-3 mb-4">

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #1cc88a !important;">
                <div class="card-body text-center py-4">
                    <i class='bx bxs-check-circle' style="font-size:3rem;color:#1cc88a"></i>
                    <h3 class="fw-bold mt-2 mb-0">{{ mesas_libres }}</h3>
                    <p class="text-muted mb-0">Mesas disponibles</p>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #e74a3b !important;">
                <div class="card-body text-center py-4">
                    <i class='bx bxs-time' style="font-size:3rem;color:#e74a3b"></i>
                    <h3 class="fw-bold mt-2 mb-0">{{ mesas_ocupadas }}</h3>
                    <p class="text-muted mb-0">Mesas ocupadas</p>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-0 shadow-sm h-100" style="border-left:4px solid #4e73df !important;">
                <div class="card-body d-flex align-items-center justify-content-center">
                    <a href="{% url 'apl:menu:pedido_create' %}" class="btn btn-primary w-100 py-3">
                        <i class='bx bx-plus-circle d-block' style="font-size:2rem;"></i>
                        Nuevo Pedido
                    </a>
                </div>
            </div>
        </div>

    </div>

    <!-- Mapa de mesas -->
    <div class="row g-3 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0"><i class='bx bxs-map me-2'></i>Estado de mesas</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        {% for item in mesas_con_estado %}
                        <div class="col-xl-2 col-lg-3 col-md-4 col-6">
                            <div class="card border-2 text-center py-3
                                {% if item.ocupada %}border-danger bg-danger bg-opacity-10
                                {% else %}border-success bg-success bg-opacity-10{% endif %}">
                                <i class='bx bxs-chair d-block'
                                   style="font-size:2rem;
                                   color:{% if item.ocupada %}#e74a3b{% else %}#1cc88a{% endif %}"></i>
                                <strong class="small">Mesa {{ item.mesa.numero }}</strong>
                                <small class="d-block text-muted">{{ item.mesa.ubicacion }}</small>
                                {% if item.ocupada %}
                                    <span class="badge bg-danger mt-1">Ocupada</span>
                                    {% if item.pedido_activo %}
                                    <a href="{% url 'apl:menu:pedido_detail' item.pedido_activo.pk %}"
                                       class="btn btn-sm btn-outline-danger mt-2 py-0">Ver pedido</a>
                                    {% endif %}
                                {% else %}
                                    <span class="badge bg-success mt-1">Libre</span>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-muted text-center py-3">No hay mesas registradas</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pedidos activos del mesero -->
    <div class="row g-3 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0"><i class='bx bx-list-ul me-2'></i>Pedidos activos</h6>
                    <a href="{% url 'apl:menu:pedido_list' %}" class="btn btn-sm btn-outline-primary">Ver todos</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Pedido</th>
                                    <th>Cliente</th>
                                    <th>Mesa</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>AcciÃ³n</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pedido in pedidos_recientes %}
                                <tr>
                                    <td class="ps-3"><small class="fw-bold">#{{ pedido.numero_pedido }}</small></td>
                                    <td><small>{{ pedido.cliente_nombre }}</small></td>
                                    <td><small>{{ pedido.mesa|default:"Para llevar" }}</small></td>
                                    <td><small>${{ pedido.total|floatformat:2 }}</small></td>
                                    <td>
                                        {% if pedido.estado == 'pendiente' %}
                                            <span class="badge bg-warning text-dark">Pendiente</span>
                                        {% elif pedido.estado == 'preparando' %}
                                            <span class="badge bg-info">Preparando</span>
                                        {% elif pedido.estado == 'listo' %}
                                            <span class="badge bg-success">Listo âœ“</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'apl:menu:pedido_detail' pedido.pk %}"
                                           class="btn btn-sm btn-outline-secondary py-0">Ver</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-3">
                                        No hay pedidos activos en este momento
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% endif %}
    {# â”€â”€ fin mesero â”€â”€ #}

</div>
{% endblock %}


{% block js_custom %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
Chart.defaults.font.family = "'Segoe UI', sans-serif";
Chart.defaults.color = '#858796';

{% if cargo == 'administrador' or cargo == 'cajera' %}

// â”€â”€ GrÃ¡fico de lÃ­nea: Ingresos semana â”€â”€
const ctxIngresos = document.getElementById('chartIngresos');
if (ctxIngresos) {
    new Chart(ctxIngresos, {
        type: 'line',
        data: {
            labels: {{ labels_semana|safe }},
            datasets: [{
                label: 'Ingresos ($)',
                data: {{ ingresos_semana|safe }},
                borderColor: '#4e73df',
                backgroundColor: 'rgba(78,115,223,0.1)',
                borderWidth: 2,
                pointBackgroundColor: '#4e73df',
                pointRadius: 4,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: v => '$' + v.toLocaleString()
                    }
                }
            }
        }
    });
}

// â”€â”€ GrÃ¡fico dona: MÃ©todos de pago â”€â”€
const ctxMetodos = document.getElementById('chartMetodos');
if (ctxMetodos) {
    new Chart(ctxMetodos, {
        type: 'doughnut',
        data: {
            labels: {{ metodos_labels|safe }},
            datasets: [{
                data: {{ metodos_data|safe }},
                backgroundColor: {{ metodos_colores|safe }},
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            cutout: '65%',
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
}

{% endif %}

{% if cargo == 'administrador' %}

// â”€â”€ GrÃ¡fico dona: Pedidos por estado â”€â”€
const ctxEstados = document.getElementById('chartEstados');
if (ctxEstados) {
    new Chart(ctxEstados, {
        type: 'doughnut',
        data: {
            labels: {{ estados_labels|safe }},
            datasets: [{
                data: {{ estados_data|safe }},
                backgroundColor: {{ estados_bg|safe }},
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            cutout: '60%',
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
}

{% endif %}

{% if cargo == 'cocinero' or cargo == 'parrilla' %}

// â”€â”€ GrÃ¡fico dona: Estado pedidos (cocina) â”€â”€
const ctxEstados = document.getElementById('chartEstados');
if (ctxEstados) {
    new Chart(ctxEstados, {
        type: 'doughnut',
        data: {
            labels: {{ estados_labels|safe }},
            datasets: [{
                data: {{ estados_data|safe }},
                backgroundColor: {{ estados_bg|safe }},
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            cutout: '60%',
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
}

{% endif %}
</script>
{% endblock %}