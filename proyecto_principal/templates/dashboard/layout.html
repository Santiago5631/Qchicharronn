{% load static %}
{% load permisos_tags %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mi Proyecto{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" href="{% static 'imagenes/favicon.png' %}">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Select2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <!-- TUS CSS -->
    <link rel="stylesheet" href="{% static 'lib/css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'lib/css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'lib/css/modales-select2.css' %}">

    {% block css_plugins %}{% endblock %}
</head>

<body>

{% include 'dashboard/aside/sidebar.html' %}

<div class="main-content">
    {% include 'dashboard/header.html' %}

    <div class="page-content">
        {% block content %}{% endblock %}
    </div>
</div>

{% include 'dashboard/footer.html' %}

<!-- ============================= -->
<!-- LIBRERÍAS BASE                -->
<!-- ============================= -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>


<!-- Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- DataTables -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<!-- SweetAlert -->
<script src="{% static 'lib/vendor/sweetalert2/sweetalert2.all.min.js' %}"></script>

<!-- Scripts del sistema -->
<script src="{% static 'lib/js/sidebar.js' %}"></script>
<script src="{% static 'lib/js/navbar.js' %}"></script>
<script src="{% static 'lib/js/sienna.js' %}"></script>
<script src="{% static 'lib/js/modales.js' %}"></script>

{% block js_plugins %}{% endblock %}
{% block js_custom %}{% endblock %}

<!-- ============================= -->
<!-- INICIALIZACIONES GLOBALES     -->
<!-- ============================= -->

<script>

document.addEventListener('DOMContentLoaded', function () {

    /* =========================
       SELECT2 GLOBAL
    ========================= */
    if ($.fn.select2) {
        $('.select2').select2({
            width: '100%',
            language: "es"
        });
    }

    /* =========================
       DATATABLE GLOBAL
    ========================= */
    if ($.fn.DataTable) {
        $('.datatable').DataTable({
            language: {
                lengthMenu: "Mostrar _MENU_ registros por página",
                zeroRecords: "No se encontraron resultados",
                info: "Mostrando página _PAGE_ de _PAGES_",
                infoEmpty: "No hay registros disponibles",
                infoFiltered: "(filtrado de _MAX_ registros totales)",
                search: "Buscar:",
                paginate: {
                    first: "Primero",
                    last: "Último",
                    next: "Siguiente",
                    previous: "Anterior"
                }
            },
            pageLength: 10,
            responsive: true,
            autoWidth: false
        });
    }

});


/* =========================
   SWEETALERT DELETE GLOBAL
========================= */
$(document).on("click", ".btn-delete", function (e) {
    e.preventDefault();

    let url  = $(this).data("url");
    let name = $(this).data("name");

    Swal.fire({
        title: "¿Estás seguro?",
        text: `Se eliminará "${name}"`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#e74a3b",
        cancelButtonColor: "#858796",
        confirmButtonText: "Sí, eliminar",
        cancelButtonText: "Cancelar"
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: url,
                type: "POST",
                data: {
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                },
                success: function (response) {
                    if (response.status === "ok") {
                        Swal.fire({
                            title: "¡Eliminado!",
                            text: `"${name}" fue eliminado correctamente.`,
                            icon: "success",
                            confirmButtonColor: "#1cc88a"
                        }).then(() => {
                            location.reload();
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        title: "Error",
                        text: "No se pudo eliminar el registro",
                        icon: "error"
                    });
                }
            });
        }
    });
});

</script>

{% block js_init %}{% endblock %}


<!-- ============================= -->
<!-- MENSAJES DE DJANGO            -->
<!-- ============================= -->

{% if messages %}
<script>
{% for message in messages %}
Swal.fire({
    title: "{% if message.tags == 'success' %}Éxito{% elif message.tags == 'error' %}Error{% else %}Aviso{% endif %}",
    text: "{{ message|escapejs }}",
    icon: "{{ message.tags }}",
    showConfirmButton: false,
    timer: 3000
});
{% endfor %}
</script>
{% endif %}

</body>
</html>