{% extends "dashboard/layout.html" %}
{% comment %}
Este template solo contiene JS para mostrar SweetAlert2
Variables esperadas:
- url_delete: URL para eliminar
- nombre_objeto: Nombre del objeto a eliminar
- button_selector: selector del bot칩n que activ칩 la alerta
{% endcomment %}
<form style="display:none;">
    {% csrf_token %}
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll(".btn-delete").forEach(function(button) {

        button.addEventListener("click", function () {

            const url = this.dataset.url;
            const nombre = this.dataset.nombre;
            const csrf_token = document.querySelector('[name=csrfmiddlewaretoken]').value;

            Swal.fire({
                title: "쮼st치s seguro?",
                text: `Se eliminar치 "${nombre}"`,
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "S칤, eliminar",
                cancelButtonText: "Cancelar"
            }).then(function(result) {

                if (result.isConfirmed) {

                    fetch(url, {
                        method: "POST",
                        headers: {
                            "X-CSRFToken": csrf_token,
                            "X-Requested-With": "XMLHttpRequest"
                        }
                    })
                    .then(function(response) {

                        if (!response.ok) {
                            throw new Error("Error del servidor");
                        }

                        return response.json();
                    })
                    .then(function(data) {

                        if (data.success) {

                            Swal.fire({
                                title: "Eliminado",
                                text: `"${nombre}" fue eliminado correctamente`,
                                icon: "success",
                                timer: 1000,
                                showConfirmButton: false
                            });

                            // 游댠 Recarga segura despu칠s de 1 segundo
                            setTimeout(function() {
                                window.location.href = window.location.href;
                            }, 1000);

                        } else {
                            Swal.fire("Error", "No se pudo eliminar", "error");
                        }

                    })
                    .catch(function(error) {
                        console.error(error);
                        Swal.fire("Error", "Ocurri칩 un problema al eliminar", "error");
                    });

                }

            });

        });

    });

});
</script>

