{% extends 'dashboard/layout.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'lib/css/forms.css' %}">
<link rel="stylesheet" href="{% static 'lib/css/custom.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">

<div class="form-container">
    <h1 class="form-title">CREAR PLATO</h1>

    <form method="post" id="formPlato">
        {% csrf_token %}
        <!-- Campos principales -->
        <p><label>Nombre:</label>{{ form.nombre }}</p>
        <p><label>Descripci칩n:</label>{{ form.descripcion }}</p>
        <p><label>Precio:</label>{{ form.precio }}</p>

        <!-- Tabla de productos agregados -->
        <h3 style="text-align:center; margin-top:20px;">Productos del Plato</h3>
        <table class="table table-bordered" id="tablaProductos">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Unidad</th>
                    <th>Acci칩n</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Bot칩n para abrir modal -->
        <button type="button" class="create-button" id="btnAgregarProducto">+ Agregar Producto</button>

        <!-- Campo oculto donde se guardan los productos a침adidos -->
        <input type="hidden" name="productos_json" id="productos_json">

        <button type="submit" class="create-button" style="margin-top: 20px;">Crear Plato</button>
    </form>

    <div class="back-link">
        <button type="button" onclick="window.history.back();">Volver</button>
    </div>
</div>

<!-- MODAL -->
<div id="modalProducto" class="simple-modal">
    <div class="modal-content">
        <h3>Agregar Producto</h3>
        <form id="formAgregarProducto" method="post">
            {% csrf_token %}
            <label>Producto:</label>
            <select id="productoSelect" name="producto" required>
                <option value="">-- Seleccione --</option>
                {% for p in productos %}
                    <option value="{{ p.id }}">{{ p.nombre }}</option>
                {% endfor %}
            </select>

            <label>Cantidad:</label>
            <input type="number" name="cantidad" id="cantidadInput" step="0.01" min="0.01" required>

            <label>Unidad:</label>
            <select id="unidadSelect" name="unidad" required>
                <option value="">-- Seleccione --</option>
                {% for u in unidades %}
                    <option value="{{ u.id }}">{{ u.nombre }}</option>
                {% endfor %}
            </select>

            <div class="modal-buttons">
                <button type="button" class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
                <button type="submit" class="btn-save">Agregar</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="{% static 'lib/js/crear_plato.js' %}"></script>

{% endblock %}
